<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Luxury Auto LegacyRP</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#121212;color:#eee;display:flex;justify-content:center;align-items:center;min-height:100vh;}
*{box-sizing:border-box;}
#startScreen{width:360px;background:#1f1f1f;padding:36px;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.6);text-align:center;}
#startScreen input{width:100%;padding:12px;border-radius:10px;border:1px solid #333;background:#222;color:#eee;margin-top:8px;}
#startScreen button{width:100%;margin-top:12px;padding:10px;border-radius:10px;border:none;background:#4caf50;color:#fff;cursor:pointer;font-weight:600;transition:all 0.2s ease-in-out;}
#startScreen button:hover{background:#66bb6a;transform: translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
#startScreen button:active{transform: translateY(0);box-shadow:0 2px 6px rgba(0,0,0,0.2);}
#loginMsg{color:#ff7777;margin-top:8px;font-size:0.9rem;}
#app{display:none;width:100%;height:100vh;position:relative;}
#logoutBtn{position:absolute;top:12px;right:12px;padding:6px 10px;border-radius:8px;background:#333;border:none;color:#eee;opacity:.8;cursor:pointer;transition:all 0.2s ease-in-out;}
#logoutBtn:hover{opacity:1;transform:translateY(-2px);}
.container{display:flex;height:100vh;}
.sidebar{width:280px;background:#1f1f1f;padding:20px;box-shadow:2px 0 18px rgba(0,0,0,.5);overflow:auto;}
.sidebar button,input{display:block;width:100%;margin:6px 0;padding:10px;border-radius:10px;border:none;background:#333;color:#eee;cursor:pointer;transition:all 0.2s ease-in-out;font-weight:600;}
.sidebar button:hover{background:#555;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
.main{flex:1;display:flex;align-items:center;justify-content:center;}
.card{width:420px;background:#1f1f1f;padding:28px;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.6);text-align:center;}
input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #333;background:#222;color:#fff;text-align:center;}
ul{list-style:none;padding:0;margin:8px 0;max-height:260px;overflow:auto;}
li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:#2b2b2b;margin-bottom:6px;font-family:monospace;}
li.accepted{background:#264b27;color:#c8ffc8;}
.status{margin-top:12px;font-weight:600;}
.delete-btn{background:#c62828;border:none;color:#fff;padding:6px 8px;border-radius:6px;cursor:pointer;transition:all 0.2s ease-in-out;}
.delete-btn:hover{background:#e53935;transform:translateY(-2px);}
button#gen1, button#gen10{background:#2196f3;}
button#gen1:hover, button#gen10:hover{background:#42a5f5;}
#savePassBtn{background:#555;transition:all 0.2s ease-in-out;}
#savePassBtn.active{background:#4caf50;}
#checkBtn{width:100%;padding:12px;border-radius:10px;background:#2196f3;color:#fff;font-weight:600;transition:all 0.2s ease-in-out;}
#checkBtn:hover{background:#42a5f5;transform:translateY(-2px);}
#refreshBtn{width:100%;padding:12px;border-radius:10px;background:#9e9e9e;color:#fff;margin-top:8px;cursor:pointer;font-weight:600;transition:all 0.2s ease-in-out;}
#refreshBtn:hover{background:#bdbdbd;transform:translateY(-2px);}
#modalBg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;}
#modalBg div{background:#1f1f1f;padding:18px;border-radius:12px;color:#fff;width:320px;text-align:center;}
#modalBg button{margin-top:8px;padding:8px 12px;border-radius:8px;cursor:pointer;}
#modalConfirm{background:#c62828;color:#fff;border:none;}
#modalCancel{background:#444;color:#fff;border:none;}
</style>
</head>
<body>

<div id="startScreen">
<h1>Luxury Auto LegacyRP</h1>
<input id="loginInput" type="password" placeholder="Indtast kodeord (user / admin)" />
<button id="loginBtn">Login</button>
<div id="loginMsg"></div>
</div>

<div id="app">
<button id="logoutBtn">Log ud</button>
<div class="container">
<aside class="sidebar">
<strong>Menu</strong>
<button id="gen1">Generer kode</button>
<button id="gen10">Generer 10 koder</button>
<hr style="border:none;height:1px;background:#2a2a2a;margin:8px 0">
<h4>Genererede koder</h4>
<ul id="codeList"></ul>
<h4>Accepterede koder</h4>
<ul id="acceptedList"></ul>
<div id="passwordSection" style="display:none;margin-top:12px">
<h4>Skift adgangskoder (admin)</h4>
<input id="newUserPass" placeholder="Ny user kode" />
<input id="newAdminPass" placeholder="Ny admin kode" />
<button id="savePassBtn">Gem koder</button>
</div>
</aside>
<main class="main">
<div class="card">
<h2>Tjek en kode</h2>
<input id="inputCode" type="text" placeholder="Indtast kode" />
<button id="checkBtn">Tjek kode</button>
<button id="refreshBtn">Refresh</button>
<div id="status" class="status"></div>
</div>
</main>
</div>
</div>

<div id="modalBg">
<div>
<div id="modalText">Er du sikker?</div>
<div style="margin-top:12px">
<button id="modalConfirm">Slet</button>
<button id="modalCancel">Annuller</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCty24wq93pwk09219HyvJiEjZr-c5sXQ4",
  authDomain: "legacyrp-88309.firebaseapp.com",
  projectId: "legacyrp-88309",
  storageBucket: "legacyrp-88309.appspot.com",
  messagingSenderId: "1020527070649",
  appId: "1:1020527070649:web:4d9e9b8b858ba4e5f83a68",
  measurementId: "G-TNKT0K0FBB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const stateDocRef = doc(db,"appState","state");

let state = { codes: [], acceptedCodes: [], passwords: { user: "user", admin: "admin" } };
let isAdmin=false;
let deleteTarget=null;

const startScreen=document.getElementById("startScreen");
const appDiv=document.getElementById("app");
const loginInput=document.getElementById("loginInput");
const loginMsg=document.getElementById("loginMsg");
const passwordSection=document.getElementById("passwordSection");
const codeList=document.getElementById("codeList");
const acceptedList=document.getElementById("acceptedList");
const inputCode=document.getElementById("inputCode");
const statusDiv=document.getElementById("status");
const newUserPass=document.getElementById("newUserPass");
const newAdminPass=document.getElementById("newAdminPass");
const gen1=document.getElementById("gen1");
const gen10=document.getElementById("gen10");
const checkBtn=document.getElementById("checkBtn");
const savePassBtn=document.getElementById("savePassBtn");
const logoutBtn=document.getElementById("logoutBtn");
const refreshBtn=document.getElementById("refreshBtn");
const modalBg=document.getElementById("modalBg");
const modalConfirm=document.getElementById("modalConfirm");
const modalCancel=document.getElementById("modalCancel");

async function loadState(){
  const snap=await getDoc(stateDocRef);
  if(!snap.exists()){
    await setDoc(stateDocRef,state);
  } else state = snap.data();
}
async function saveState(){ await setDoc(stateDocRef,state,{merge:true}); }

document.getElementById("loginBtn").addEventListener("click", async()=>{
  await loadState();
  const val=loginInput.value.trim();
  if(val===state.passwords.user){ isAdmin=false; showApp(); }
  else if(val===state.passwords.admin){ isAdmin=true; showApp(); }
  else loginMsg.innerText="Forkert kodeord!";
});

function showApp(){
  startScreen.style.display="none";
  appDiv.style.display="block";
  passwordSection.style.display=isAdmin?"block":"none";
  renderLists();
}

logoutBtn.addEventListener("click", ()=>{
  appDiv.style.display="none";
  startScreen.style.display="block";
  loginInput.value=""; loginMsg.innerText=""; statusDiv.innerText="";
});

function randomCode(){ const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; let c=""; for(let i=0;i<5;i++) c+=chars.charAt(Math.floor(Math.random()*chars.length)); return c; }
async function generateCodes(count){
  for(let i=0;i<count;i++) state.codes.push({code:randomCode(),active:false,accepted:false});
  await saveState(); await loadState(); renderLists();
}
gen1.addEventListener("click",()=>generateCodes(1));
gen10.addEventListener("click",()=>generateCodes(10));

async function toggleActive(index){ state.codes[index].active=!state.codes[index].active; await saveState(); await loadState(); renderLists(); }

checkBtn.addEventListener("click", async()=>{
  const code=inputCode.value.trim().toUpperCase();
  const fIndex=state.codes.findIndex(c=>c.code===code && c.active && !c.accepted);
  if(fIndex>=0){
    const found=state.codes.splice(fIndex,1)[0]; found.accepted=true; state.acceptedCodes.push(found);
    await saveState(); await loadState(); renderLists();
    statusDiv.innerText="✅ Accepteret"; statusDiv.className="status accepted";
  } else { statusDiv.innerText="❌ Afvist"; statusDiv.className="status"; }
  inputCode.value="";
});

refreshBtn.addEventListener("click", async () => {
  await loadState();
  renderLists();
  statusDiv.innerText = "✅ Koder opdateret";
});

function renderLists(){
  codeList.innerHTML=""; acceptedList.innerHTML="";
  state.codes.forEach((c,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`<span>${c.code}</span><div style="display:flex;gap:8px;align-items:center"><input type="checkbox" ${c.active?"checked":""}>${isAdmin?'<button class="delete-btn">X</button>':''}</div>`;
    li.querySelector("input[type=checkbox]").addEventListener("change",()=>toggleActive(i));
    if(isAdmin) li.querySelector(".delete-btn").addEventListener("click",()=>confirmDelete('code',i));
    codeList.appendChild(li);
  });
  state.acceptedCodes.forEach((c,i)=>{
    const li=document.createElement("li"); li.className="accepted";
    li.innerHTML=`${c.code}${isAdmin?'<button class="delete-btn">X</button>':''}`;
    if(isAdmin) li.querySelector(".delete-btn").addEventListener("click",()=>confirmDelete('accepted',i));
    acceptedList.appendChild(li);
  });
}

function confirmDelete(type,index){ deleteTarget={type,index}; modalBg.style.display="flex"; }
modalCancel.addEventListener("click",()=>{ modalBg.style.display="none"; deleteTarget=null; });
modalConfirm.addEventListener("click", async()=>{
  if(!deleteTarget) return;
  if(deleteTarget.type==="code") state.codes.splice(deleteTarget.index,1);
  else state.acceptedCodes.splice(deleteTarget.index,1);
  await saveState(); await loadState(); renderLists();
  modalBg.style.display="none"; deleteTarget=null;
});

savePassBtn.addEventListener("click", async()=>{
  if(!isAdmin) return alert("Kun admin kan ændre kodeord.");
  if(newUserPass.value.trim()) state.passwords.user=newUserPass.value.trim();
  if(newAdminPass.value.trim()) state.passwords.admin=newAdminPass.value.trim();
  await saveState(); await loadState();
  alert("Adgangskoder opdateret"); newUserPass.value=""; newAdminPass.value="";
  updateSaveBtnState();
});

function updateSaveBtnState(){
  if(newUserPass.value.trim() || newAdminPass.value.trim()){
    savePassBtn.classList.add("active");
  } else {
    savePassBtn.classList.remove("active");
  }
}
newUserPass.addEventListener("input", updateSaveBtnState);
newAdminPass.addEventListener("input", updateSaveBtnState);
</script>
</body>
</html>
